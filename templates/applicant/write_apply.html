{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/variable.css' %}">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/write_apply.css' %}">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
        }
    </style>
</head>
<body>
    <header>
      <nav>
         <div id="nav_title">
             <a href='{% url "accounts:initialApplicant" %}'>Hire Hub</a>
         </div>
     </nav>
    </header>
    <main>
      <div class="apply_container">
         <h2>지원서 | {{ template.name }}</h2>
         <p>{{ template.description }}</p>
         <form action="" method="post" id="applyForm">
            {% csrf_token %}
            <div class="apply_content">
               <input type="text" name="name" placeholder="이름">
               <input type="number" name="phone_number" placeholder="전화번호">
               <input type="text" name="school" placeholder="대학교">
               <input type="text" name="major" placeholder="주전공">
               <ol class="questions_list">
                  {% for question in template.questions.all %}
                     <li class="question">
                        <label for="question_{{question.id}}">{{question.question_text}}</label>
                        <textarea name="answer_{{question.id}}" id="answer_{{question.id}}" cols="50" rows="5"></textarea>
                     </li>
                  {% endfor %}
               </ol>
            </div>
         </form>
         <button type="submit" onclick="submitForm()">제출</button>
      </div>
      <script>
         function submitForm() {
            let valid = true;
            let invalidField = null;
            let invalidFieldName = "";
      
            let applicant_infos = ["name", "phone_number", "school", "major"];
            applicant_infos.forEach(function(applicant_info) {
               let info = document.querySelector(`input[name='${applicant_info}']`);
               if (info.value.trim() == "" && valid) {
                  valid = false;
                  invalidField = info;
                  invalidFieldName = info.placeholder;
               }
            });
      
            if (valid) {
               let questions = document.querySelectorAll("textarea[name^='answer_']");
               questions.forEach(function(question) {
                  if (question.value.trim() == "" && valid) {
                     valid = false;
                     invalidField = question;
                  }
               });
            }
            
            if (!valid) {
               if (invalidFieldName == "") {
                  alert("모든 질문에 답변을 작성해주세요");
               } else {
                  alert(invalidFieldName + "을(를) 작성해주세요");
               }
               invalidField.focus();
               return false;
            }
      
            if (valid) {
               document.getElementById("applyForm").submit();
            }
         }
      </script>
    </main>
</body>
</html>


